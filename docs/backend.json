{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the heat treating application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile.",
          "format": "uuid"
        },
        "username": {
          "type": "string",
          "description": "User's username for login and display purposes."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "preferredAlloys": {
          "type": "array",
          "description": "List of alloy IDs the user has marked as preferred.",
          "items": {
            "type": "string"
          }
        },
        "savedResources": {
          "type": "array",
          "description": "List of resource IDs the user has saved (e.g., process guides, glossary terms).",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "Alloy": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Alloy",
      "type": "object",
      "description": "Represents a specific alloy with its properties and recommended treatments.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the alloy.",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "description": "Common name of the alloy."
        },
        "composition": {
          "type": "string",
          "description": "Chemical composition of the alloy."
        },
        "properties": {
          "type": "string",
          "description": "Key properties of the alloy (e.g., tensile strength, yield strength)."
        },
        "recommendedHeatTreatments": {
          "type": "array",
          "description": "References to recommended heat treatment process IDs for this alloy.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "composition"
      ]
    },
    "HeatTreatmentProcess": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HeatTreatmentProcess",
      "type": "object",
      "description": "Represents a specific heat treatment process.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the heat treatment process.",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "description": "Name of the heat treatment process (e.g., Annealing, Quenching)."
        },
        "description": {
          "type": "string",
          "description": "Detailed explanation of the heat treatment process."
        },
        "processParameters": {
          "type": "string",
          "description": "Typical process parameters (e.g., temperature, duration)."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "GlossaryTerm": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GlossaryTerm",
      "type": "object",
      "description": "Represents a term in the interactive glossary.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the glossary term.",
          "format": "uuid"
        },
        "term": {
          "type": "string",
          "description": "The glossary term."
        },
        "definition": {
          "type": "string",
          "description": "Definition of the term."
        }
      },
      "required": [
        "id",
        "term",
        "definition"
      ]
    },
    "ForumPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ForumPost",
      "type": "object",
      "description": "Represents a post in the community forum.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the forum post.",
          "format": "uuid"
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the UserProfile who created the post. (Relationship: UserProfile 1:N ForumPost)"
        },
        "title": {
          "type": "string",
          "description": "Title of the forum post."
        },
        "content": {
          "type": "string",
          "description": "Content of the forum post."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the post was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "authorId",
        "title",
        "content",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  Accessible only by the user with matching userId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/alloys/{alloyId}",
        "definition": {
          "entityName": "Alloy",
          "schema": {
            "$ref": "#/backend/entities/Alloy"
          },
          "description": "Stores alloy data; publicly readable.",
          "params": [
            {
              "name": "alloyId",
              "description": "The unique identifier for the alloy."
            }
          ]
        }
      },
      {
        "path": "/heatTreatmentProcesses/{processId}",
        "definition": {
          "entityName": "HeatTreatmentProcess",
          "schema": {
            "$ref": "#/backend/entities/HeatTreatmentProcess"
          },
          "description": "Stores heat treatment process data; publicly readable.",
          "params": [
            {
              "name": "processId",
              "description": "The unique identifier for the heat treatment process."
            }
          ]
        }
      },
      {
        "path": "/glossaryTerms/{termId}",
        "definition": {
          "entityName": "GlossaryTerm",
          "schema": {
            "$ref": "#/backend/entities/GlossaryTerm"
          },
          "description": "Stores glossary terms and definitions; publicly readable.",
          "params": [
            {
              "name": "termId",
              "description": "The unique identifier for the glossary term."
            }
          ]
        }
      },
      {
        "path": "/forumPosts/{postId}",
        "definition": {
          "entityName": "ForumPost",
          "schema": {
            "$ref": "#/backend/entities/ForumPost"
          },
          "description": "Stores forum posts. Includes denormalized 'authorId' for authorization independence.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier for the forum post."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to optimize security, scalability, and debuggability, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. It avoids hierarchical authorization dependencies by denormalizing authorization data and segregates data based on access needs. Path-based ownership is favored where appropriate.\n\n*   **User Profiles:** Stored in `/users/{userId}/profile`.  This allows simple security rules based on `request.auth.uid == userId`.\n*   **Alloys, Heat Treatment Processes, and Glossary Terms:** These are global, relatively static data sets. Therefore, they are stored in top-level collections (`/alloys`, `/heatTreatmentProcesses`, and `/glossaryTerms`) with public read access.\n*   **Forum Posts:** Stored in `/forumPosts/{postId}`.  The `authorId` is included in each document, enabling filtering and display by author.  List operations can be secured via rules that allow reading any post. Creation requires a valid `authorId` that matches `request.auth.uid`.\n\n**Authorization Independence:** Achieved by storing the `authorId` inside the `/forumPosts/{postId}` documents, allowing rules to validate the author without needing to `get()` the user profile. QAPs for forum posts are supported because all posts have the same security posture, so list operations are not filtered based on data content.\n\n**Denormalization**: The `authorId` on `ForumPost` allows secure list operations without needing to perform `get()` operations in the rules, fulfilling the Authorization Independence requirement."
  }
}